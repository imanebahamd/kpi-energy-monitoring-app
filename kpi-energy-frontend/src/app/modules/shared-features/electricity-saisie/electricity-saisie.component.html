<div class="container">
  <!-- En-tÃªte principal -->
  <div class="main-header">
    <h2>Saisie et monitoring des donnÃ©es Ã©nergÃ©tiques</h2>
  </div>

  <!-- Alerte dynamique -->
  <div *ngIf="showAlert"
       class="dynamic-alert"
       [ngClass]="alertType">
    {{ alertMessage }}
  </div>

  <!-- Conteneur du formulaire -->
  <div class="form-container" [ngClass]="{'visible': isFormVisible}">
    <form [formGroup]="electricityForm" (ngSubmit)="onSubmit()">

      <!-- SÃ©lecteur de date -->
      <!-- SÃ©lecteur de date -->
      <div class="date-selector">
        <div class="date-header">
          <div class="icon">ğŸ“…</div>
          <h4>PÃ©riode de saisie</h4>
        </div>

        <div class="date-fields-row">
          <div class="form-group compact-field">
            <label class="form-label">AnnÃ©e</label>
            <input type="number"
                   class="form-control"
                   formControlName="year"
                   min="2000"
                   max="2100"
                   [ngClass]="{'error': electricityForm.get('year')?.invalid && electricityForm.get('year')?.touched}">
            <div *ngIf="electricityForm.get('year')?.invalid && electricityForm.get('year')?.touched"
                 class="error-message">
              Entre 2000 et 2100
            </div>
          </div>

          <div class="form-group compact-field">
            <label class="form-label">Mois</label>
            <select class="form-select"
                    formControlName="month"
                    [ngClass]="{'error': electricityForm.get('month')?.invalid && electricityForm.get('month')?.touched}">
              <option *ngFor="let month of months" [value]="month.value">{{month.name}}</option>
            </select>
            <div *ngIf="electricityForm.get('month')?.invalid && electricityForm.get('month')?.touched"
                 class="error-message">
              SÃ©lection requise
            </div>
          </div>
        </div>
      </div>

      <!-- RÃ©seau 60KV -->
      <div class="network-card network-60kv"
           [ngClass]="{'animate-in': networkAnimationState['60kv']}">
        <div class="card-header network-60kv">
          <div class="header-content">
            <div class="network-icon">âš¡</div>
            <h3>RÃ©seau Haute Tension 60KV</h3>
          </div>
          <button type="button"
                  class="reset-btn"
                  (click)="resetNetwork60kv()"
                  title="RÃ©initialiser les donnÃ©es 60KV">
            ğŸ”„ RÃ©initialiser
          </button>
        </div>

        <div class="card-body">
          <div class="inputs-grid">
            <div class="form-group">
              <label class="form-label">
                <span>ğŸ’¡</span> Ã‰nergie Active (KWh)
              </label>
              <input type="number"
                     class="form-control"
                     formControlName="network60kvActiveEnergy"
                     step="0.01"
                     min="0"
                     placeholder="Saisir l'Ã©nergie active..."
                     [ngClass]="{'error': electricityForm.get('network60kvActiveEnergy')?.invalid && electricityForm.get('network60kvActiveEnergy')?.touched}">
              <div *ngIf="electricityForm.get('network60kvActiveEnergy')?.invalid && electricityForm.get('network60kvActiveEnergy')?.touched"
                   class="error-message">
                âš ï¸ Veuillez saisir une valeur positive
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span>ğŸ”‹</span> Ã‰nergie RÃ©active (KVARh)
              </label>
              <input type="number"
                     class="form-control"
                     formControlName="network60kvReactiveEnergy"
                     step="0.01"
                     min="0"
                     placeholder="Saisir l'Ã©nergie rÃ©active..."
                     [ngClass]="{'error': electricityForm.get('network60kvReactiveEnergy')?.invalid && electricityForm.get('network60kvReactiveEnergy')?.touched}">
              <div *ngIf="electricityForm.get('network60kvReactiveEnergy')?.invalid && electricityForm.get('network60kvReactiveEnergy')?.touched"
                   class="error-message">
                âš ï¸ Veuillez saisir une valeur positive
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span>ğŸ“Š</span> Pointe du mois (KW)
              </label>
              <input type="number"
                     class="form-control"
                     formControlName="network60kvPeak"
                     step="0.01"
                     min="0"
                     placeholder="Saisir la pointe..."
                     [ngClass]="{'error': electricityForm.get('network60kvPeak')?.invalid && electricityForm.get('network60kvPeak')?.touched}">
              <div *ngIf="electricityForm.get('network60kvPeak')?.invalid && electricityForm.get('network60kvPeak')?.touched"
                   class="error-message">
                âš ï¸ Veuillez saisir une valeur positive
              </div>
            </div>
          </div>

          <div class="metrics-grid">
            <div class="metric-card" [ngClass]="powerFactor60Class">
              <div class="metric-label">
                âš¡ Facteur de puissance (cos Ï†)
              </div>
              <div class="metric-value">
                {{ calculated60kvPowerFactor ? (calculated60kvPowerFactor | number:'1.3-3') : '--' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RÃ©seau 22KV -->
      <div class="network-card network-22kv"
           [ngClass]="{'animate-in': networkAnimationState['22kv']}">
        <div class="card-header network-22kv">
          <div class="header-content">
            <div class="network-icon">ğŸ”Œ</div>
            <h3>RÃ©seau Moyenne Tension 22KV</h3>
          </div>
          <button type="button"
                  class="reset-btn"
                  (click)="resetNetwork22kv()"
                  title="RÃ©initialiser les donnÃ©es 22KV">
            ğŸ”„ RÃ©initialiser
          </button>
        </div>

        <div class="card-body">
          <div class="inputs-grid">
            <div class="form-group">
              <label class="form-label">
                <span>ğŸ’¡</span> Ã‰nergie Active (KWh)
              </label>
              <input type="number"
                     class="form-control"
                     formControlName="network22kvActiveEnergy"
                     step="0.01"
                     min="0"
                     placeholder="Saisir l'Ã©nergie active..."
                     [ngClass]="{'error': electricityForm.get('network22kvActiveEnergy')?.invalid && electricityForm.get('network22kvActiveEnergy')?.touched}">
              <div *ngIf="electricityForm.get('network22kvActiveEnergy')?.invalid && electricityForm.get('network22kvActiveEnergy')?.touched"
                   class="error-message">
                âš ï¸ Veuillez saisir une valeur positive
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span>ğŸ”‹</span> Ã‰nergie RÃ©active (KVARh)
              </label>
              <input type="number"
                     class="form-control"
                     formControlName="network22kvReactiveEnergy"
                     step="0.01"
                     min="0"
                     placeholder="Saisir l'Ã©nergie rÃ©active..."
                     [ngClass]="{'error': electricityForm.get('network22kvReactiveEnergy')?.invalid && electricityForm.get('network22kvReactiveEnergy')?.touched}">
              <div *ngIf="electricityForm.get('network22kvReactiveEnergy')?.invalid && electricityForm.get('network22kvReactiveEnergy')?.touched"
                   class="error-message">
                âš ï¸ Veuillez saisir une valeur positive
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span>ğŸ“Š</span> Pointe du mois (KW)
              </label>
              <input type="number"
                     class="form-control"
                     formControlName="network22kvPeak"
                     step="0.01"
                     min="0"
                     placeholder="Saisir la pointe..."
                     [ngClass]="{'error': electricityForm.get('network22kvPeak')?.invalid && electricityForm.get('network22kvPeak')?.touched}">
              <div *ngIf="electricityForm.get('network22kvPeak')?.invalid && electricityForm.get('network22kvPeak')?.touched"
                   class="error-message">
                âš ï¸ Veuillez saisir une valeur positive
              </div>
            </div>
          </div>

          <div class="metrics-grid">
            <div class="metric-card" [ngClass]="powerFactor22Class">
              <div class="metric-label">
                âš¡ Facteur de puissance (cos Ï†)
              </div>
              <div class="metric-value">
                {{ calculated22kvPowerFactor ? (calculated22kvPowerFactor | number:'1.3-3') : '--' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Carte de synthÃ¨se totale -->
      <div class="network-card total-card"
           [ngClass]="{'animate-in': networkAnimationState['total']}">
        <div class="card-header total-card">
          <div class="header-content">
            <div class="network-icon">ğŸ“ˆ</div>
            <h3>SynthÃ¨se Ã‰nergÃ©tique Globale</h3>
          </div>
        </div>

        <div class="card-body">
          <div class="metrics-grid">
            <div class="metric-card" [ngClass]="totalEnergyClass">
              <div class="metric-label">
                âš¡ Total Ã©nergie active consommÃ©e
              </div>
              <div class="metric-value">
                {{ totalActiveEnergy ? (totalActiveEnergy | number:'1.2-2') : '--' }}
                <span class="metric-unit">KWh</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Boutons d'action -->
      <div class="action-buttons">
        <div class="primary-actions">
          <button type="submit"
                  class="btn btn-primary"
                  [disabled]="electricityForm.invalid || isLoading">
            <span *ngIf="!isLoading">
              ğŸ’¾ Enregistrer les donnÃ©es
            </span>
            <span *ngIf="isLoading">
              <div class="loading-spinner"></div>
              Enregistrement en cours...
            </span>
          </button>

          <button type="button"
                  class="btn btn-outline-secondary"
                  (click)="resetAll()"
                  [disabled]="isLoading">
            ğŸ—‘ï¸ Tout rÃ©initialiser
          </button>
        </div>

        <div class="secondary-actions">
          <a [routerLink]="[getRoutePrefix(), 'electricity-monthly']" class="btn btn-outline-info">
            ğŸ“Š Tableau Mensuel
          </a>
          <a [routerLink]="[getRoutePrefix(), 'electricity-annual']" class="btn btn-outline-info">
            ğŸ“… Rapport Annuel
          </a>
          <a [routerLink]="[getRoutePrefix(), 'electricity-graphs']" class="btn btn-outline-info">
            ğŸ“ˆ Visualisations
          </a>
        </div>
      </div>
    </form>
  </div>
</div>
