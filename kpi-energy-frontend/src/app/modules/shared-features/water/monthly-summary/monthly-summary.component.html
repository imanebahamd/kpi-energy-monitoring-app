<div class="water-monthly-container">
  <!-- Alert message -->
  <div *ngIf="showAlert" class="dynamic-alert" [ngClass]="alertType">
    <div class="alert-content">
      <i class="alert-icon" [ngClass]="alertType"></i>
      <span>{{ alertMessage }}</span>
    </div>
  </div>

  <header class="water-header">
    <div class="header-content">
      <h1 class="water-title">Tableau Mensuel de Production d'Eau</h1>
      <p class="water-subtitle">Surveillance et analyse des donnÃ©es de production d'eau mensuelles</p>
    </div>
    <div class="header-actions">
      <a [routerLink]="[getRoutePrefix(), 'water-saisie']" class="action-button primary">
        <i class="icon add"></i> Saisir Nouvelles DonnÃ©es
      </a>
    </div>
  </header>

  <div class="filters-card">
    <div class="date-selector">
      <div class="date-header">
        <div class="icon">ðŸ“…</div>
        <h4>Filtres de pÃ©riode</h4>
      </div>

      <div class="filters-content">
        <div class="filter-row">
          <div class="form-group">
            <label class="form-label">AnnÃ©e</label>
            <input id="year" type="number" class="form-control" [(ngModel)]="selectedYear"
                   (change)="onFilterChange()"
                   min="2000" max="2100"
                   placeholder="Entrez l'annÃ©e">
          </div>

          <div class="form-group" *ngIf="!showPeriodSelection && showMonthSelection">
            <label class="form-label">Mois</label>
            <select class="form-select" [(ngModel)]="selectedMonth" (change)="onFilterChange()">
              <option [ngValue]="null" disabled>SÃ©lectionnez un mois</option>
              <option *ngFor="let m of months" [value]="m.value">{{ m.name }}</option>
            </select>
          </div>

          <div class="form-group" *ngIf="showPeriodSelection">
            <label class="form-label">De</label>
            <select class="form-select" [(ngModel)]="startMonth" (change)="onFilterChange()">
              <option [ngValue]="null" disabled>Mois de dÃ©but</option>
              <option *ngFor="let m of months" [value]="m.value">{{ m.name }}</option>
            </select>
          </div>

          <div class="form-group" *ngIf="showPeriodSelection">
            <label class="form-label">Ã€</label>
            <select class="form-select" [(ngModel)]="endMonth" (change)="onFilterChange()">
              <option [ngValue]="null" disabled>Mois de fin</option>
              <option *ngFor="let m of months" [value]="m.value">{{ m.name }}</option>
            </select>
          </div>

          <div class="form-group period-toggle-group">
            <label class="form-label" style="visibility: hidden;">Toggle</label>
            <button (click)="togglePeriodSelection()" class="period-toggle">
              {{ showPeriodSelection ? 'SÃ©lection simple' : 'PÃ©riode' }}
            </button>
          </div>

          <div class="form-group month-toggle-group" *ngIf="!showPeriodSelection">
            <label class="form-label" style="visibility: hidden;">Toggle</label>
            <button (click)="toggleMonthSelection()" class="period-toggle">
              {{ showMonthSelection ? 'Masquer mois' : 'Afficher mois' }}
            </button>
          </div>

          <div class="form-group submit-button-group">
            <label class="form-label" style="visibility: hidden;">Submit</label>
            <button (click)="showPeriodSelection ? loadPeriodData() : loadSingleMonthData()"
                    [disabled]="!selectedYear || (showMonthSelection && !selectedMonth && !showPeriodSelection) || (showPeriodSelection && (!startMonth || !endMonth)) || isLoading"
                    class="action-button primary">
              <span *ngIf="!isLoading">Afficher les donnÃ©es</span>
              <span *ngIf="isLoading" class="spinner"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="status-card loading">
    <div class="spinner"></div>
    <span>Chargement en cours...</span>
  </div>

  <div *ngIf="error && filtersTouched" class="status-card error">
    <i class="icon warning"></i>
    <span>{{ error }}</span>
  </div>

  <!-- Affichage pour un mois prÃ©cis -->
  <div *ngIf="singleMonthData && showMonthSelection && !showPeriodSelection" class="data-section">
    <div class="section-header">
      <h2><i class="icon calendar"></i> DonnÃ©es pour {{ getMonthName(selectedMonth) }} {{ selectedYear }}</h2>
      <div class="section-actions" *ngIf="isAdminUser">
        <a [routerLink]="[getRoutePrefix(), 'water-saisie']"
           [queryParams]="{year: singleMonthData.year, month: singleMonthData.month}"
           class="action-button secondary">
          <i class="icon edit"></i> Modifier
        </a>
        <button (click)="deleteData(singleMonthData.year, singleMonthData.month)"
                class="action-button danger">
          <i class="icon delete"></i> Supprimer
        </button>
      </div>
    </div>

    <div class="data-grid">
      <div class="data-card">
        <div class="card-header f3bis">
          <h3>F3BIS</h3>
        </div>
        <div class="card-content">
          <div class="data-item">
            <span class="label">Volume (mÂ³)</span>
            <span class="value">{{ singleMonthData.f3bis | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>

      <div class="data-card">
        <div class="card-header f3">
          <h3>F3</h3>
        </div>
        <div class="card-content">
          <div class="data-item">
            <span class="label">Volume (mÂ³)</span>
            <span class="value">{{ singleMonthData.f3 | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>

      <div class="data-card">
        <div class="card-header se2">
          <h3>SE2</h3>
        </div>
        <div class="card-content">
          <div class="data-item">
            <span class="label">Volume (mÂ³)</span>
            <span class="value">{{ singleMonthData.se2 | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>

      <div class="data-card">
        <div class="card-header se3bis">
          <h3>SE3BIS</h3>
        </div>
        <div class="card-content">
          <div class="data-item">
            <span class="label">Volume (mÂ³)</span>
            <span class="value">{{ singleMonthData.se3bis | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>

      <div class="data-card">
        <div class="card-header total">
          <h3>Total Production</h3>
        </div>
        <div class="card-content">
          <div class="data-item">
            <span class="label">Volume (mÂ³)</span>
            <span class="value">{{ singleMonthData.totalProduction | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Affichage pour une pÃ©riode -->
  <div *ngIf="periodData.length > 0 && showPeriodSelection" class="period-section">
    <div class="section-header">
      <h2><i class="icon calendar-range"></i> DonnÃ©es pour la pÃ©riode de {{ getMonthName(startMonth) }} Ã  {{ getMonthName(endMonth) }} {{ selectedYear }}</h2>
    </div>

    <div class="period-grid">
      <div *ngFor="let item of periodData" class="period-card">
        <div class="period-header">
          <h3>{{ getMonthName(item.month) }} {{ item.year }}</h3>
          <div class="period-actions" *ngIf="isAdminUser">
            <a [routerLink]="[getRoutePrefix(), 'water-saisie']"
               [queryParams]="{year: item.year, month: item.month}"
               class="action-button small secondary">
              <i class="icon edit"></i>
            </a>
            <button (click)="deleteData(item.year, item.month)"
                    class="action-button small danger">
              <i class="icon delete"></i>
            </button>
          </div>
        </div>

        <div class="period-content">
          <div class="data-row">
            <div class="data-item">
              <span>F3BIS:</span>
              <span class="numeric">{{ item.f3bis | number:'1.2-2' }} mÂ³</span>
            </div>
            <div class="data-item">
              <span>F3:</span>
              <span class="numeric">{{ item.f3 | number:'1.2-2' }} mÂ³</span>
            </div>
            <div class="data-item">
              <span>SE2:</span>
              <span class="numeric">{{ item.se2 | number:'1.2-2' }} mÂ³</span>
            </div>
            <div class="data-item">
              <span>SE3BIS:</span>
              <span class="numeric">{{ item.se3bis | number:'1.2-2' }} mÂ³</span>
            </div>
            <div class="data-item total">
              <span>Total:</span>
              <span class="numeric">{{ item.totalProduction | number:'1.2-2' }} mÂ³</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="period-total">
      <h3>Total de la pÃ©riode</h3>
      <div class="total-content">
        <div class="total-item">
          <span>F3BIS:</span>
          <span class="numeric">{{ calculateTotal(periodData).f3bis | number:'1.2-2' }} mÂ³</span>
        </div>
        <div class="total-item">
          <span>F3:</span>
          <span class="numeric">{{ calculateTotal(periodData).f3 | number:'1.2-2' }} mÂ³</span>
        </div>
        <div class="total-item">
          <span>SE2:</span>
          <span class="numeric">{{ calculateTotal(periodData).se2 | number:'1.2-2' }} mÂ³</span>
        </div>
        <div class="total-item">
          <span>SE3BIS:</span>
          <span class="numeric">{{ calculateTotal(periodData).se3bis | number:'1.2-2' }} mÂ³</span>
        </div>
        <div class="total-item grand-total">
          <span>Total Production:</span>
          <span class="numeric">{{ calculateTotal(periodData).totalProduction | number:'1.2-2' }} mÂ³</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation section -->
  <div class="navigation-section">
    <div class="navigation-header">
      <h3>Navigation Rapide</h3>
      <p>AccÃ©dez aux autres sections du module eau</p>
    </div>

    <div class="navigation-grid">
      <a [routerLink]="[getRoutePrefix(), 'water-annual']" class="navigation-card">
        <div class="nav-icon">
          <i class="icon calendar"></i>
        </div>
        <div class="nav-content">
          <h4>Tableau Annuel</h4>
          <p>Consulter les donnÃ©es annuelles de production d'eau</p>
        </div>
      </a>

      <a [routerLink]="[getRoutePrefix(), 'water-graphs']" class="navigation-card">
        <div class="nav-icon">
          <i class="icon chart"></i>
        </div>
        <div class="nav-content">
          <h4>Visualisations</h4>
          <p>Analyser les graphiques de production d'eau</p>
        </div>
      </a>
    </div>
  </div>
</div>
