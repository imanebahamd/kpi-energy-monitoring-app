<div class="water-graphs-container">
  <div class="water-graphs-content">
    <!-- Alerte dynamique -->
    <div *ngIf="showAlert" class="alert-container" [attr.data-type]="alertType">
      <div class="alert-content">
        {{ alertMessage }}
      </div>
    </div>

    <!-- En-tête -->
    <header class="graphs-header">
      <h1 class="header-title">Visualisation de la Production d'Eau</h1>

      <div class="header-actions">
        <a [routerLink]="[getRoutePrefix(), 'water-saisie']" class="btn btn-primary">
          Saisir Nouvelles Données
        </a>
        <a [routerLink]="[getRoutePrefix(), 'water-monthly']" class="btn btn-secondary">
          Tableau Mensuel
        </a>
        <a [routerLink]="[getRoutePrefix(), 'water-annual']" class="btn btn-info">
          Tableau Annuel
        </a>
      </div>
    </header>

    <!-- Sélecteur d'année -->
    <div class="year-selector">
      <label>Année:</label>
      <select [(ngModel)]="selectedYear" (change)="loadData()" [disabled]="isLoading">
        <option *ngFor="let year of years" [value]="year">{{year}}</option>
      </select>
      <span *ngIf="isLoading" class="loading-spinner"></span>
    </div>

    <!-- Messages d'état -->
    <div *ngIf="isLoading" class="status-message loading">
      Chargement des données en cours...
    </div>

    <div *ngIf="!isLoading && monthlyData.length === 0" class="status-message no-data">
      Aucune donnée disponible pour l'année sélectionnée
    </div>

    <!-- Onglets et graphiques -->
    <mat-tab-group *ngIf="!isLoading && monthlyData.length > 0">
      <mat-tab label="Tendance Mensuelle">
        <div class="chart-container">
          <p-chart type="line" [data]="monthlyTrendChart" [options]="chartOptions"></p-chart>
        </div>
      </mat-tab>

      <mat-tab label="Comparaison Mensuelle">
        <div class="chart-container">
          <p-chart type="bar" [data]="monthlyComparisonChart" [options]="chartOptions"></p-chart>
        </div>
      </mat-tab>

      <mat-tab label="Composition Annuelle">
        <div class="chart-container">
          <p-chart type="pie" [data]="compositionChart" [options]="chartOptions"></p-chart>
        </div>
      </mat-tab>
    </mat-tab-group>

    <!-- Résumé des données -->
    <div *ngIf="!isLoading && monthlyData.length > 0" class="data-summary">
      <h2 class="summary-title">Résumé des Données pour {{selectedYear}}</h2>
      <div class="summary-cards">
        <div class="summary-card">
          <h3 class="card-title">Production Totale</h3>
          <p class="card-value">{{ getTotalProduction() | number:'1.2-2' }} m³</p>
        </div>

        <div class="summary-card">
          <h3 class="card-title">Moyenne Mensuelle</h3>
          <p class="card-value">{{ getAverageProduction() | number:'1.2-2' }} m³</p>
        </div>

        <div class="summary-card">
          <h3 class="card-title">Max Mensuel</h3>
          <p class="card-value">{{ getMaxProduction() | number:'1.2-2' }} m³</p>
        </div>

        <div class="summary-card">
          <h3 class="card-title">Min Mensuel</h3>
          <p class="card-value">{{ getMinProduction() | number:'1.2-2' }} m³</p>
        </div>
      </div>
    </div>
  </div>
</div>
