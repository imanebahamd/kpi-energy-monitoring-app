<div class="container">
  <!-- Alert message -->
  <div *ngIf="showAlert" class="dynamic-alert" [ngClass]="alertType">
    {{ alertMessage }}
  </div>

  <div class="header">
    <h2>Tableau Annuel de Production d'Eau</h2>
    <div class="header-actions">
      <a routerLink="/water-saisie" class="btn btn-primary">
        <i class="icon add"></i> Saisir Nouvelles Données
      </a>
      <a routerLink="/water-monthly" class="btn btn-secondary">
        <i class="icon calendar"></i> Tableau Mensuel
      </a>
      <a routerLink="/water-graphs" class="btn btn-info">
        <i class="icon chart"></i> Visualisation Graphique
      </a>
    </div>
  </div>

  <div class="year-selector">
    <label>Année: </label>
    <select [(ngModel)]="selectedYear" (change)="loadData()" [disabled]="isLoading">
      <option *ngFor="let year of years" [value]="year">{{year}}</option>
    </select>
    <span *ngIf="isLoading" class="loading-spinner"></span>
  </div>

  <div *ngIf="isLoading" class="loading-message">
    Chargement des données en cours...
  </div>

  <div *ngIf="noDataAvailable && !isLoading" class="no-data">
    <i class="icon warning"></i>
    <span>Aucune donnée disponible pour l'année {{selectedYear}}</span>
  </div>

  <div *ngIf="monthlyData.length > 0 && !isLoading" class="data-section">
    <h3>Données pour l'année {{selectedYear}}</h3>
    <table>
      <thead>
      <tr>
        <th>Mois</th>
        <th>F3BIS (m³)</th>
        <th>F3 (m³)</th>
        <th>SE2 (m³)</th>
        <th>SE3BIS (m³)</th>
        <th>Total Production (m³)</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of monthlyData">
        <td>{{ getMonthName(item.month) }}</td>
        <td>{{ item.f3bis | number:'1.2-2' }}</td>
        <td>{{ item.f3 | number:'1.2-2' }}</td>
        <td>{{ item.se2 | number:'1.2-2' }}</td>
        <td>{{ item.se3bis | number:'1.2-2' }}</td>
        <td>{{ item.totalProduction | number:'1.2-2' }}</td>
      </tr>
      <tr class="total-row">
        <td><strong>Total Année</strong></td>
        <td><strong>{{ calculateYearlyTotal().f3bis | number:'1.2-2' }}</strong></td>
        <td><strong>{{ calculateYearlyTotal().f3 | number:'1.2-2' }}</strong></td>
        <td><strong>{{ calculateYearlyTotal().se2 | number:'1.2-2' }}</strong></td>
        <td><strong>{{ calculateYearlyTotal().se3bis | number:'1.2-2' }}</strong></td>
        <td><strong>{{ calculateYearlyTotal().totalProduction | number:'1.2-2' }}</strong></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
