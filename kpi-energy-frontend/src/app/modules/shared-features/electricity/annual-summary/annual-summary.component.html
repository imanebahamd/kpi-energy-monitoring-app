<div class="annual-summary-container">
  <div class="header">
    <h2>
      <i class="bi bi-calendar-year"></i>
      Synthèse annuelle des consommations électriques
    </h2>

    <div class="actions">
      <a routerLink="/admin/electricity-monthly" class="btn btn-outline-primary">
        <i class="bi bi-calendar-month"></i> Vue mensuelle
      </a>
    </div>
  </div>

  <div class="filters">
    <div class="filter-group">
      <label for="year">Année :</label>
      <input id="year" type="number" [(ngModel)]="year" min="2000" max="2100">
    </div>

    <button (click)="loadSummary()" [disabled]="isLoading">
      <span *ngIf="!isLoading"><i class="bi bi-arrow-clockwise"></i> Actualiser</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm"></span>
    </button>
  </div>

  <div *ngIf="isLoading" class="status-message loading">
    <div class="spinner-border text-primary" role="status"></div>
    <span>Chargement des données en cours...</span>
  </div>

  <div *ngIf="error" class="status-message error">
    <i class="bi bi-exclamation-triangle-fill"></i>
    <span>{{ error }}</span>
  </div>

  <div *ngIf="noDataAvailable && !error && !isLoading" class="status-message info">
    <i class="bi bi-info-circle-fill"></i>
    <span>Aucune donnée disponible pour l'année {{ year }}</span>
  </div>

  <div *ngIf="summaries.length > 0 && !isLoading" class="summary-table">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
        <tr>
          <th rowspan="2">Mois</th>
          <th colspan="3">Réseau 60KV</th>
          <th colspan="3">Réseau 22KV</th>
        </tr>
        <tr>
          <th>Pointe (KW)</th>
          <th>cosφ</th>
          <th>Consommation (KWh)</th>
          <th>Pointe (KW)</th>
          <th>cosφ</th>
          <th>Consommation (KWh)</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let summary of summaries">
          <td><strong>{{ getMonthName(summary.month) }}</strong></td>
          <td>{{ summary.network60kvPeak | number:'1.2-2' }}</td>
          <td [ngClass]="getCosphiStatus60kv(summary.network60kvPowerFactor)">
            {{ summary.network60kvPowerFactor | number:'1.3-3' }}
          </td>
          <td>{{ summary.network60kvConsumption | number:'1.2-2' }}</td>
          <td>{{ summary.network22kvPeak | number:'1.2-2' }}</td>
          <td [ngClass]="getCosphiStatus22kv(summary.network22kvPowerFactor)">
            {{ summary.network22kvPowerFactor | number:'1.3-3' }}
          </td>
          <td>{{ summary.network22kvConsumption | number:'1.2-2' }}</td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
          <td><strong>Totaux/Moyennes</strong></td>
          <td></td>
          <td>{{ averagePowerFactor60kv | number:'1.3-3' }}</td>
          <td>{{ total60kvConsumption | number:'1.2-2' }}</td>
          <td></td>
          <td>{{ averagePowerFactor22kv | number:'1.3-3' }}</td>
          <td>{{ total22kvConsumption | number:'1.2-2' }}</td>
        </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
