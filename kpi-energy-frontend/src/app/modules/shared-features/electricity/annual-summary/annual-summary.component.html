<div class="water-annual-container">
  <div class="water-annual-content">
    <!-- Alerte dynamique -->
    <div *ngIf="showAlert" class="alert-container" [attr.data-type]="alertType">
      <div class="alert-content">
        {{ alertMessage }}
      </div>
    </div>

    <!-- En-tête -->
    <header class="annual-header">
      <h1 class="header-title">
        <i class="icon calendar"></i>
        Tableau Annuel Électrique
      </h1>

      <div class="header-actions">
        <a [routerLink]="[getRoutePrefix(), 'electricity-saisie']" class="btn btn-primary">
          <i class="icon add"></i> Saisir Nouvelles Données
        </a>
        <a [routerLink]="[getRoutePrefix(), 'electricity-monthly']" class="btn btn-secondary">
          <i class="icon calendar-month"></i> Vue Mensuelle
        </a>
        <a [routerLink]="[getRoutePrefix(), 'electricity-graphs']" class="btn btn-info">
          <i class="icon chart"></i> Visualisation Graphique
        </a>
      </div>
    </header>

    <!-- Message d'information -->
    <div class="info-message">
      <i class="icon info"></i>
      <p>Cette page vous permet de consulter les données électriques annuelles. Sélectionnez une année pour afficher le récapitulatif complet. Les totaux et moyennes sont calculés automatiquement à partir des données mensuelles.</p>
    </div>

    <!-- Sélecteur d'année -->
    <div class="year-selector">
      <label>Année:</label>
      <input type="number" [(ngModel)]="year"
             min="2000" max="2100"
             placeholder="Entrez l'année"
             (change)="loadSummary()"
             [disabled]="isLoading">
      <span *ngIf="isLoading" class="loading-spinner"></span>
    </div>

    <!-- Messages d'état -->
    <div *ngIf="isLoading" class="status-message loading">
      <span class="spinner"></span> Chargement en cours...
    </div>

    <div *ngIf="error" class="status-message error">
      <i class="icon warning"></i>
      <span>{{ error }}</span>
    </div>

    <div *ngIf="noDataAvailable && !error && !isLoading" class="status-message no-data">
      <i class="icon info"></i>
      <span>Aucune donnée disponible pour l'année {{ year }}</span>
    </div>

    <!-- Section de données -->
    <div *ngIf="summaries.length > 0 && !isLoading" class="data-section">
      <h2 class="section-title">
        <i class="icon calendar"></i> Données pour l'année {{ year }}
      </h2>

      <div class="table-responsive">
        <table class="data-table">
          <thead>
          <tr>
            <th rowspan="2">Mois</th>
            <th colspan="3">Réseau 60KV</th>
            <th colspan="3">Réseau 22KV</th>
          </tr>
          <tr>
            <th>Pointe (KW)</th>
            <th>cosφ</th>
            <th>Consommation (KWh)</th>
            <th>Pointe (KW)</th>
            <th>cosφ</th>
            <th>Consommation (KWh)</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let summary of summaries">
            <td><strong>{{ getMonthName(summary.month) }}</strong></td>
            <td class="numeric">{{ summary.network60kvPeak | number:'1.2-2' }}</td>
            <td class="numeric" [class]="getCosphiStatus60kv(summary.network60kvPowerFactor)">
              {{ summary.network60kvPowerFactor | number:'1.3-3' }}
              <i class="icon small" [class]="getStatusIcon(getCosphiStatus60kv(summary.network60kvPowerFactor))"></i>
            </td>
            <td class="numeric">{{ summary.network60kvConsumption | number:'1.2-2' }}</td>
            <td class="numeric">{{ summary.network22kvPeak | number:'1.2-2' }}</td>
            <td class="numeric" [class]="getCosphiStatus22kv(summary.network22kvPowerFactor)">
              {{ summary.network22kvPowerFactor | number:'1.3-3' }}
              <i class="icon small" [class]="getStatusIcon(getCosphiStatus22kv(summary.network22kvPowerFactor))"></i>
            </td>
            <td class="numeric">{{ summary.network22kvConsumption | number:'1.2-2' }}</td>
          </tr>
          </tbody>
          <tfoot>
          <tr class="total-row">
            <td><strong>Totaux/Moyennes</strong></td>
            <td></td>
            <td class="numeric">{{ averagePowerFactor60kv | number:'1.3-3' }}</td>
            <td class="numeric">{{ total60kvConsumption | number:'1.2-2' }}</td>
            <td></td>
            <td class="numeric">{{ averagePowerFactor22kv | number:'1.3-3' }}</td>
            <td class="numeric">{{ total22kvConsumption | number:'1.2-2' }}</td>
          </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>
